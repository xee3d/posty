# Android 광고 잠금 해제 테스트 체크리스트

## 변경 사항 요약

### 주요 수정
1. **Promise 기반 보상 대기**: `showAd()`가 실제 토큰 지급까지 대기
2. **이벤트 동기화**: EARNED_REWARD, CLOSED, ERROR 이벤트에서 Promise 해결
3. **InteractionManager 사용**: Android UI 프리징 방지
4. **개선된 에러 처리**: 사용자 친화적 에러 메시지

### 기대 효과
- ✅ Android에서도 잠금 해제 알림 정상 표시
- ✅ UI 프리징 문제 해결
- ✅ 토큰 지급과 UI 업데이트 동기화
- ✅ 광고 중단 시 명확한 피드백

## 테스트 시나리오

### 시나리오 1: 정상 광고 시청 및 잠금 해제
**목적**: 광고를 끝까지 시청하여 스타일 잠금 해제

**단계**:
1. Android 에뮬레이터에서 앱 실행
2. FREE 플랜 확인 (토큰 있음)
3. AI 글쓰기 화면으로 이동
4. 프리미엄 스타일 선택 (minimalist, motivational, formal 중 하나)
5. "광고 보고 해제하기" 버튼 클릭
6. 광고를 끝까지 시청 (5초 이상, dev 모드)
7. 광고 닫기

**예상 결과**:
- ✅ "잠금 해제 성공! 🎉" 알림 표시
- ✅ "[스타일명] 스타일을 1회 사용할 수 있어요!" 메시지
- ✅ 확인 버튼 클릭 시 해당 스타일 자동 선택
- ✅ UI 프리징 없음
- ✅ 토큰 1개 추가 (로그 확인)

**로그 확인**:
```
RewardAdService: 광고 로드 완료
RewardAdService: 광고 표시 완료, 보상 대기 중...
RewardAdService: 광고 열림
RewardAdService: 보상 획득 이벤트 수신: [amount]
RewardAdService: 보상 검증 성공, 토큰 지급: 1
RewardAdService: 토큰 지급 완료
RewardAdService: 보상 처리 결과: {type: "tokens", amount: 1, success: true}
광고 표시 결과: {type: "tokens", amount: 1, success: true}
스타일 활성화 중: [toneId]
업데이트된 adWatchedTones: ["[toneId]"]
```

---

### 시나리오 2: 광고 중간에 닫기
**목적**: 광고를 끝까지 시청하지 않고 중단한 경우 처리 확인

**단계**:
1. FREE 플랜으로 프리미엄 스타일 선택
2. "광고 보고 해제하기" 클릭
3. 광고가 표시되면 즉시 뒤로가기/닫기 (5초 전)

**예상 결과**:
- ✅ "광고 시청 미완료" 알림 표시
- ✅ "광고를 끝까지 시청해야 스타일을 잠금 해제할 수 있어요." 메시지
- ✅ 스타일 잠금 해제 안됨
- ✅ 토큰 지급 안됨

**로그 확인**:
```
RewardAdService: 광고 표시 완료, 보상 대기 중...
RewardAdService: 광고 열림
RewardAdService: 광고 닫힘
RewardAdService: 광고가 보상 없이 닫힘
RewardAdService: 보상 처리 결과: null
광고 표시 결과: null
광고 표시 실패 또는 보상 미수령: null
```

---

### 시나리오 3: 광고 로드 실패
**목적**: 네트워크 문제 등으로 광고 로드 실패 시 처리 확인

**단계**:
1. 에뮬레이터 네트워크 끄기 (또는 AdMob 한도 초과 상태)
2. 프리미엄 스타일 선택
3. "광고 보고 해제하기" 클릭

**예상 결과**:
- ✅ "광고 로드 실패" 알림 표시
- ✅ "잠시 후 다시 시도해주세요." 메시지
- ✅ 스타일 잠금 상태 유지

**로그 확인**:
```
RewardAdService: 광고 로드 시작
RewardAdService: 광고 로드 타임아웃 (또는 오류)
광고 로드 실패
```

---

### 시나리오 4: 일일 광고 한도 초과
**목적**: 하루 10회 광고 시청 한도 초과 시 처리 확인

**단계**:
1. 광고를 10회 시청하여 한도 도달
2. 추가로 광고 시청 시도

**예상 결과**:
- ✅ "일일 광고 한도 초과" 로그
- ✅ 광고 표시 안됨
- ✅ 적절한 에러 메시지

---

### 시나리오 5: 1회 사용 스타일 사용 후 제거
**목적**: 광고로 해제한 스타일을 1회 사용한 후 다시 잠김 확인

**단계**:
1. 광고 시청으로 스타일 잠금 해제 (시나리오 1 완료)
2. 해당 스타일로 콘텐츠 생성
3. 다시 해당 스타일 선택 시도

**예상 결과**:
- ✅ 1회 사용 후 다시 잠금 상태로 전환
- ✅ 다시 "광고 보고 해제하기" 또는 "Pro 구독하기" 선택지 표시

**로그 확인**:
```
// 사용 후
업데이트된 adWatchedTones: [] (빈 배열)
```

---

### 시나리오 6: iOS와 Android 동작 일치 확인
**목적**: 플랫폼 간 일관성 확인

**단계**:
1. iOS 시뮬레이터에서 시나리오 1 실행
2. Android 에뮬레이터에서 시나리오 1 실행
3. 동작 비교

**예상 결과**:
- ✅ 동일한 로그 순서
- ✅ 동일한 UI 흐름
- ✅ 동일한 알림 메시지
- ✅ 동일한 스타일 활성화 동작

---

## 성능 체크

### 메모리 및 리소스
- [ ] 광고 시청 후 메모리 누수 없음
- [ ] 연속 광고 시청 시 앱 안정성 유지
- [ ] 백그라운드 복귀 후 정상 작동

### UI 응답성
- [ ] 광고 닫기 후 즉시 UI 반응
- [ ] 알림 표시 시 프리징 없음
- [ ] 스타일 선택 시 부드러운 전환

### 에러 복구
- [ ] 광고 오류 후 다시 시도 가능
- [ ] 네트워크 복구 후 정상 작동
- [ ] 앱 재시작 후 상태 유지

---

## 주요 로그 패턴

### 성공 플로우
```
1. RewardAdService: 광고 로드 완료
2. RewardAdService: 광고 표시 완료, 보상 대기 중...
3. RewardAdService: 광고 열림
4. RewardAdService: 보상 획득 이벤트 수신
5. RewardAdService: 보상 검증 성공, 토큰 지급: 1
6. RewardAdService: 토큰 지급 완료
7. RewardAdService: 보상 처리 결과: success
8. 스타일 활성화 중
9. 업데이트된 adWatchedTones
10. RewardAdService: 광고 닫힘
```

### 실패 플로우 (조기 종료)
```
1. RewardAdService: 광고 표시 완료, 보상 대기 중...
2. RewardAdService: 광고 열림
3. RewardAdService: 광고 닫힘
4. RewardAdService: 광고가 보상 없이 닫힘
5. 광고 표시 실패 또는 보상 미수령
```

### 에러 플로우
```
1. RewardAdService: 광고 오류
2. RewardAdService: 광고 오류로 인한 실패
3. 광고 표시 실패
```

---

## 회귀 테스트

이전 이슈가 재발하지 않았는지 확인:

### 1. 보상 금액 검증 (✅ 해결됨)
- [ ] AdMob이 10을 반환해도 1 토큰만 지급
- [ ] 개발 모드에서 유연한 검증 (1-100 허용)
- [ ] 프로덕션에서 엄격한 검증 (1-10)

### 2. 토큰 서비스 임포트 (✅ 해결됨)
- [ ] default import 정상 작동
- [ ] 토큰 지급 함수 호출 성공

### 3. 시청 시간 검증 (✅ 해결됨)
- [ ] 개발 모드: 5초 이상 시청 필요
- [ ] 프로덕션: 15초 이상 시청 필요
- [ ] 부족 시 명확한 에러 메시지

### 4. 이벤트 타입 (✅ 해결됨)
- [ ] RewardedAdEventType.LOADED 사용
- [ ] RewardedAdEventType.EARNED_REWARD 사용
- [ ] AdEventType.CLOSED/ERROR/OPENED 정상 작동

---

## 버그 리포트 템플릿

문제 발견 시 다음 정보 제공:

```
### 환경
- 플랫폼: Android / iOS
- 디바이스: [에뮬레이터/실제기기 모델]
- OS 버전:
- 앱 버전:

### 재현 단계
1.
2.
3.

### 예상 결과
-

### 실제 결과
-

### 로그 (중요!)
```
[로그 복사]
```

### 스크린샷
[첨부]
```

---

## 성공 기준

모든 시나리오에서:
- ✅ Android와 iOS 동작 일치
- ✅ UI 프리징 없음
- ✅ 알림 정상 표시
- ✅ 토큰 정확히 지급
- ✅ 스타일 잠금/해제 정상 작동
- ✅ 에러 처리 명확함

테스트 완료 후 이 체크리스트 결과 공유해주세요!
