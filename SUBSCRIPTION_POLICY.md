# 📱 Posty 구독 플랜 변경 정책

## 🔄 플랜 변경 시 토큰 처리 정책

### 1. 업그레이드 (상위 플랜으로 변경)

#### FREE → PRO
- 무제한 토큰 (9999개로 표시)
- 기존 토큰 수와 관계없이 무제한
- 토큰 히스토리에 "PRO 플랜 가입" 기록

### 2. 다운그레이드 (하위 플랜으로 변경) - 차단됨

#### 정책
- **앱 내에서 다운그레이드 불가**
- 하위 플랜 구매 버튼 비활성화
- "다운그레이드 불가" 메시지 표시

#### 다운그레이드가 필요한 경우
1. **현재 구독 취소**: 다음 갱신일까지 현재 플랜 유지
2. **구독 만료 후**: 원하는 하위 플랜으로 새로 가입
3. **고객 지원 문의**: 특별한 사유가 있는 경우

#### 기술적 이유
- 이미 지급된 토큰 회수 불가
- 사용된 기능 캘소 불가
- 결제 플랫폼 정책상 제한

#### PRO → FREE
- **구매한 토큰은 유지**
- 무료 토큰은 10개로 제한 (매일 자정 충전)
- 총 토큰 = 구매 토큰 + 10개
- 경고 메시지 표시

### 3. 다운그레이드 제한 사항

#### 기술적 제한
- 구독 취소는 가능하지만, 만료일까지 기존 플랜 혜택 유지
- 즉시 다운그레이드는 기술적으로 복잡함
- Apple/Google 정책상 구독 변경은 업그레이드만 권장

#### 권장 사항
1. **구독 취소 시**: 다음 갱신일까지 현재 플랜 유지
2. **즉시 변경 필요 시**: 고객 지원 문의
3. **재구독 시**: 새로운 플랜으로 시작

### 4. 특수 케이스

#### 구독 만료 후 재가입
- 구매한 토큰은 항상 유지
- 새 플랜의 초기 토큰 전액 지급

#### 환불 처리
- 플랫폼(Apple/Google) 정책 따름
- 환불 시 무료 플랜으로 자동 전환
- 구매한 토큰은 유지

## 🚨 주의사항

### 사용자 경험
1. **다운그레이드 전 경고**
   - 현재 보유 토큰 중 일부가 제한될 수 있음
   - 고급 기능 접근 제한
   - 광고 표시 (FREE 플랜)

2. **토큰 사용 우선순위**
   - 무료 토큰 먼저 사용
   - 구매 토큰은 나중에 사용
   - 만료 없음 (영구 보관)

### 개발 고려사항

1. **상태 관리**
   ```typescript
   // 플랜 변경 시 토큰 계산
   if (upgrading) {
     currentTokens += bonusTokens;
   } else if (downgrading) {
     freeTokens = Math.min(freeTokens, planLimit);
     currentTokens = purchasedTokens + freeTokens;
   }
   ```

2. **UI/UX**
   - 플랜 변경 전 시뮬레이션 표시
   - 변경 후 토큰 수 미리보기
   - 다운그레이드 시 경고 모달

3. **서버 동기화**
   - 플랜 변경 이력 저장
   - 토큰 변경 내역 기록
   - 부정 사용 방지

## 📋 구현 체크리스트

- [x] 업그레이드 시 토큰 누적
- [x] 다운그레이드 시 구매 토큰 보존
- [x] 토큰 히스토리 기록
- [ ] UI에 플랜 변경 미리보기
- [ ] 다운그레이드 경고 모달
- [ ] 서버 API 연동
- [ ] 플랫폼별 구독 정책 처리

## 🔐 보안 고려사항

1. **클라이언트 검증**
   - 플랜 변경은 서버에서 최종 검증
   - 토큰 계산도 서버에서 수행
   - 클라이언트는 UI 표시용

2. **중복 지급 방지**
   - 플랜 변경 이력 확인
   - 동일 플랜 재가입 시 초기 토큰 미지급
   - 타임스탬프 기반 검증

---

*이 문서는 Posty 앱의 구독 플랜 변경 정책을 정의합니다.*
*최종 수정: 2025년 1월 27일*
